<%= turbo_frame_tag dom_id card_installment do %>
  <% card_transaction = card_installment.card_transaction %>

  <%= content_tag :div,
                  class: "rounded-lg shadow-sm overflow-hidden #{card_transaction.categories&.first&.bg_colour} my-2",
                  data: { id: card_installment.id, datatable_target: :row } do %>

    <div class="p-4">
      <div class="flex items-center justify-between gap-4 w-full text-black text-sm font-semibold">
        <div class="flex-1 flex items-center justify-between gap-1 min-w-0">
          <% if @user_card_id.nil? %>
            <%= link_to card_transaction.user_card.user_card_name,
                        card_transactions_path(user_card_id: card_transaction.user_card_id, format: :turbo_stream),
                        class: "px-2 py-1 flex items-center justify-center rounded-sm bg-blue-950 border-1 border-slate-200 text-slate-200",
                        data: { turbo_frame: :center_container, turbo_prefetch: false } %>
          <% end %>

          <%= content_tag :span, card_transaction.description, class: "truncate text-md" %>
          <%= content_tag :span,
                          pretty_installments(card_installment.number, card_installment.card_installments_count),
                          class: "p-1 rounded-sm bg-white border border-black flex-shrink-0 #{'opacity-40' if card_transaction.card_installments_count == 1}" %>
        </div>
      </div>

      <div class="flex items-center justify-between py-2">
        <%= content_tag :span, l(card_installment.date, format: :short), class: "text-xs text-start flex-1" %>

        <div class="whitespace-nowrap">
          <%= from_cent_based_to_float(card_installment.price, "R$") %>
        </div>
      </div>

      <%= content_tag :div, class: "flex items-center justify-between gap-2" do %>
        <%= content_tag :div, class: "flex justify-between gap-2", data: { datatable_target: :category, id: card_transaction.categories.map(&:id) } do %>
          <% card_transaction.categories.each do |category| %>
            <%= content_tag :span, category.category_name, class: "py-1 rounded-full text-xs font-medium underline underline-offset-[3px]" %>
          <% end %>
        <% end %>

        <%= content_tag :div, class: "flex justify-between gap-2", data: { datatable_target: :entity, id: card_transaction.entities.map(&:id) } do %>
          <% card_transaction.entities.each do |entity| %>
            <%= content_tag :span, entity.entity_name, class: "px-2 py-1 rounded-full text-xs font-medium bg-slate-100 text-black border border-1 border-gray-500" %>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>
<% end %>
